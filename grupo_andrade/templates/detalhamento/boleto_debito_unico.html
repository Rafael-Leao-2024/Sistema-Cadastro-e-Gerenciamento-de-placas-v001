{% extends "layout.html" %}
{% block title %}Débito - {{ placa.placa }}{% endblock %}

{% block content %}
<div class="min-h-[70vh] py-8 px-4">
    <div class="max-w-6xl mx-auto">
        <!-- Cabeçalho -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-6">
                <div>
                    <h1 class="text-2xl font-semibold text-gray-100 mb-2 flex items-center">
                        <i class="fas fa-file-invoice-dollar text-blue-400 mr-3"></i>
                        Débito da Placa
                    </h1>
                    <p class="text-gray-400">Boletos e taxas associados</p>
                </div>
                <div class="flex flex-wrap gap-2">
                    <a href="{{ url_for('detalhamento.detalhamento_debito') }}" 
                       class="px-3 py-2 border border-gray-600 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                        <i class="fas fa-arrow-left mr-1"></i>
                        Voltar
                    </a>
                    <a href="{{ url_for('detalhamento.criar_boleto', id_placa=placa.id) }}" 
                       class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                        <i class="fas fa-plus mr-1"></i>
                        Novo Boleto
                    </a>
                </div>
            </div>

            <!-- Informações da Placa -->
            <div class="bg-gray-800 rounded-lg border border-gray-700 p-4 mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center mr-3">
                                <i class="fas fa-car text-blue-400"></i>
                            </div>
                            <div>
                                <div class="text-xl font-semibold text-gray-100">
                                    Placa: <span class="font-mono">{{ placa.placa }}</span>
                                </div>
                                <div class="text-gray-500 text-sm">Chassi: {{ placa.chassi }}</div>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="text-gray-400 text-sm">
                                <span class="text-gray-300">ID:</span> {{ placa.id }}
                            </div>
                        </div>
                    </div>
                    <div class="px-3 py-1.5 bg-gray-700 text-gray-300 rounded-lg text-sm">
                        Débito Único
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Boletos -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-100">Boletos</h2>
                <div class="text-gray-500 text-sm">
                    {{ placa.boletos|length }} boleto(s)
                </div>
            </div>

            {% if placa.boletos %}
            <div class="space-y-4">
                {% for boleto in placa.boletos %}
                <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
                    <!-- Cabeçalho do Boleto -->
                    <div class="p-4 border-b border-gray-700">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                            <div>
                                <div class="text-gray-100 font-medium mb-1">
                                    Boleto #{{ boleto.id }}
                                </div>
                                <div class="text-gray-500 text-xs">
                                    {{ boleto.data_criacao.strftime('%d/%m/%Y') }} • {{ boleto.author.username }}
                                </div>
                            </div>
                            <div class="text-green-400 font-semibold">
                                R$ {{ "%.2f"|format(boleto.total_taxas()) }}
                            </div>
                        </div>
                    </div>

                    <!-- Taxas -->
                    <div class="p-4">
                        <div class="text-gray-400 text-sm mb-3">Taxas aplicadas:</div>
                        <div class="space-y-3">
                            {% for taxa in boleto.taxas %}
                            <div class="flex justify-between items-center p-3 bg-gray-900/50 rounded border border-gray-700">
                                <div class="flex-1">
                                    <div class="text-gray-100 text-sm">{{ taxa.descricao }}</div>
                                    <div class="text-gray-500 text-xs mt-1">
                                        {% if taxa.codigo %}{{ taxa.codigo }} • {% endif %}
                                        {{ taxa.tipo or 'Padrão' }}
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-green-400 font-medium">
                                        R$ {{ "%.2f"|format(taxa.valor) }}
                                    </div>
                                    {% if taxa.data_vencimento %}
                                    <div class="text-gray-500 text-xs mt-1">
                                        Vence: {{ taxa.data_vencimento.strftime('%d/%m/%y') }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Ações -->
                    <div class="p-4 border-t border-gray-700 bg-gray-900/30">
                        <div class="flex flex-wrap gap-2">
                            <a href="{{ url_for('placas.placa_detail', placa_id=boleto.placa.id) }}"
                               class="px-3 py-1.5 border border-gray-600 text-gray-300 rounded hover:bg-gray-700 transition-colors text-xs">
                                <i class="fas fa-eye mr-1"></i>
                                Detalhes
                            </a>
                            <a href="{{ url_for('detalhamento.deletar_boleto', id_boleto=boleto.id) }}"
                               class="px-3 py-1.5 border border-gray-600 text-gray-300 rounded hover:bg-red-900/30 hover:text-red-300 transition-colors text-xs">
                                <i class="fas fa-trash mr-1"></i>
                                Excluir
                            </a>
                            <a href="{{ url_for('documentos.download_anexos', id_placa=boleto.placa.id) }}"
                               class="px-3 py-1.5 border border-gray-600 text-gray-300 rounded hover:bg-gray-700 transition-colors text-xs">
                                <i class="fas fa-file mr-1"></i>
                                Documentos
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Sem boletos -->
            <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 text-center">
                <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-file-invoice text-gray-400"></i>
                </div>
                <h3 class="text-gray-300 mb-2">Nenhum boleto encontrado</h3>
                <p class="text-gray-500 text-sm mb-6">Esta placa não possui boletos registrados</p>
                <a href="{{ url_for('detalhamento.criar_boleto', id_placa=placa.id) }}"
                   class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm inline-block">
                    <i class="fas fa-plus mr-2"></i>
                    Criar Boleto
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Ações Rápidas -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
            <h3 class="text-gray-300 text-sm font-medium mb-4">Ações</h3>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                <a href="#" class="bg-gray-700 hover:bg-gray-600 rounded-lg p-3 text-center transition-colors">
                    <i class="fas fa-history text-blue-400 mb-2 block"></i>
                    <span class="text-gray-300 text-xs">Histórico</span>
                </a>
                <a href="#" class="bg-gray-700 hover:bg-gray-600 rounded-lg p-3 text-center transition-colors">
                    <i class="fas fa-chart-bar text-green-400 mb-2 block"></i>
                    <span class="text-gray-300 text-xs">Relatórios</span>
                </a>
                <a href="#" class="bg-gray-700 hover:bg-gray-600 rounded-lg p-3 text-center transition-colors">
                    <i class="fas fa-bell text-yellow-400 mb-2 block"></i>
                    <span class="text-gray-300 text-xs">Notificações</span>
                </a>
                <a href="#" class="bg-gray-700 hover:bg-gray-600 rounded-lg p-3 text-center transition-colors">
                    <i class="fas fa-download text-purple-400 mb-2 block"></i>
                    <span class="text-gray-300 text-xs">Exportar</span>
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    /* Animações sutis */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .space-y-4 > div {
        animation: fadeIn 0.3s ease-out forwards;
        opacity: 0;
    }
    
    .space-y-4 > div:nth-child(1) { animation-delay: 0.1s; }
    .space-y-4 > div:nth-child(2) { animation-delay: 0.2s; }
    .space-y-4 > div:nth-child(3) { animation-delay: 0.3s; }
    .space-y-4 > div:nth-child(4) { animation-delay: 0.4s; }
    
    /* Responsividade extra */
    @media (max-width: 640px) {
        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-cols-4 {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Confirmar exclusão de boleto
        const deleteLinks = document.querySelectorAll('a[href*="deletar_boleto"]');
        deleteLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                if (!confirm('Tem certeza que deseja excluir este boleto?')) {
                    e.preventDefault();
                }
            });
        });
        
        // Tooltip para informações
        const infoItems = document.querySelectorAll('.truncate, .text-xs');
        infoItems.forEach(item => {
            if (item.scrollWidth > item.clientWidth) {
                item.title = item.textContent;
            }
        });
    });
</script>
{% endblock %}