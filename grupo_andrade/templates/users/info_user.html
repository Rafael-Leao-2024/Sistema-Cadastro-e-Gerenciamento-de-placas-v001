{% extends "layout.html" %}
{% block title %}Detalhes do Cliente{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900">
  <!-- Header -->
  <div class="bg-gray-800 border-b border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="p-2 bg-blue-900 rounded-lg">
              <i class="fas fa-user text-blue-400"></i>
            </div>
            <div>
              <h1 class="text-xl font-bold text-white">Detalhes do Cliente</h1>
              <p class="text-gray-400 text-sm">Informações completas do usuário</p>
            </div>
          </div>
          <a href="{{ url_for('users.listar_usuarios') }}" 
             class="flex items-center px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-lg transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            Voltar
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- User Info -->
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 mb-6">
      <div class="flex items-center space-x-4 mb-6">
        <div class="w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center">
          <i class="fas fa-user text-white text-xl"></i>
        </div>
        <div>
          <h2 class="text-2xl font-bold text-white">{{ user.username.title() }}</h2>
          <div class="flex items-center space-x-2 mt-1">
            <span class="text-gray-400">{{ user.email }}</span>
            {% if user.is_admin %}
            <span class="px-2 py-1 bg-green-900 text-green-400 rounded text-xs font-medium">
              Administrador
            </span>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-4">
          <div>
            <label class="text-sm text-gray-400 block mb-1">ID do Usuário</label>
            <p class="font-mono text-white">#{{ user.id }}</p>
          </div>
          <div>
            <label class="text-sm text-gray-400 block mb-1">RG</label>
            <p class="text-gray-200">{{ user.rg or 'Não informado' }}</p>
          </div>
          <div>
            <label class="text-sm text-gray-400 block mb-1">CPF/CNPJ</label>
            <p class="text-gray-200">{{ user.cpf_cnpj or 'Não informado' }}</p>
          </div>
        </div>
        <div class="space-y-4">
          <div>
            <label class="text-sm text-gray-400 block mb-1">Data de Cadastro</label>
            <p class="text-gray-200">
              {% if user.data_criacao %}
                {% if user.data_criacao is string %}
                  {{ user.data_criacao }}
                {% else %}
                  {{ user.data_criacao.strftime('%d/%m/%Y %H:%M') }}
                {% endif %}
              {% else %}
                N/A
              {% endif %}
            </p>
          </div>
          <div>
            <label class="text-sm text-gray-400 block mb-1">Tipo de Conta</label>
            <p class="text-gray-200 font-medium">
              {{ 'Administrador' if user.is_admin else 'Cliente' }}
            </p>
          </div>
          <div>
            <label class="text-sm text-gray-400 block mb-1">Concecionaria</label>
            <p class="text-gray-200 font-medium">
              {{ nome_loja|title if nome_loja else 'Nenhuma' }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
      <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm mb-1">Total de Placas</p>
            <p class="text-2xl font-bold text-white">{{ user.placas|length }}</p>
          </div>
          <div class="p-2 bg-blue-900 rounded-lg">
            <i class="fas fa-car text-blue-400"></i>
          </div>
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm mb-1">Endereços</p>
            <p class="text-2xl font-bold text-white">{{ user.enderecos|length }}</p>
          </div>
          <div class="p-2 bg-green-900 rounded-lg">
            <i class="fas fa-map-marker-alt text-green-400"></i>
          </div>
        </div>
      </div>

      <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm mb-1">Pagamentos</p>
            <p class="text-2xl font-bold text-white">{{ user.pagamentos|length }}</p>
          </div>
          <div class="p-2 bg-purple-900 rounded-lg">
            <i class="fas fa-credit-card text-purple-400"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Latest Addresses -->
    {% if user.enderecos %}
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 mb-6">
      <h3 class="text-lg font-bold text-white mb-4 flex items-center">
        <i class="fas fa-map-marker-alt text-blue-400 mr-2"></i>
        Últimos Endereços
      </h3>
      <div class="space-y-3">
        {% for endereco in user.enderecos[-3:] %}
        <div class="p-3 border border-gray-700 rounded-lg hover:bg-gray-700/50">
          <p class="text-gray-200">{{ endereco.rua }}, {{ endereco.bairro }} - {{ endereco.cidade }}/{{ endereco.uf }}</p>
          {% if endereco.data_criacao %}
            <p class="text-gray-500 text-sm mt-1">
              {% if endereco.data_criacao is string %}
                {{ endereco.data_criacao }}
              {% else %}
                {{ endereco.data_criacao.strftime('%d/%m/%Y') }}
              {% endif %}
            </p>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Latest Plates - CORRIGIDO COM TEMA DARK E RESPONSIVO -->
    {% if user.placas %}
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-white flex items-center">
          <i class="fas fa-car text-blue-400 mr-2"></i>
          Últimas Placas
        </h3>
        <span class="text-gray-400 text-sm">Total: {{ user.placas|length }}</span>
      </div>
      
      <!-- Desktop Table -->
      <div class="hidden md:block overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-700 bg-gray-800">
              <th class="text-left py-3 px-4 text-gray-400 font-medium">Placa</th>
              <th class="text-left py-3 px-4 text-gray-400 font-medium">Chassi</th>
              <th class="text-left py-3 px-4 text-gray-400 font-medium">Data</th>
              <th class="text-left py-3 px-4 text-gray-400 font-medium">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for placa in user.placas[:5] %}
            <tr class="border-b border-gray-700 hover:bg-gray-700/50">
              <td class="py-3 px-4 text-gray-200 font-medium">{{ placa.placa }}</td>
              <td class="py-3 px-4 text-gray-400">{{ placa.chassi or 'N/A' }}</td>
              <td class="py-3 px-4 text-gray-400">
                {% if placa.date_create %}
                  {% if placa.date_create is string %}
                    {{ placa.date_create }}
                  {% else %}
                    {{ placa.date_create.strftime('%d/%m/%Y') }}
                  {% endif %}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td class="py-3 px-4">
                {% if placa.placa_confeccionada %}
                <span class="inline-flex items-center px-2 py-1 bg-green-900/50 text-green-400 rounded text-xs">
                  Confeccionada
                </span>
                {% elif placa.placa_a_caminho %}
                <span class="inline-flex items-center px-2 py-1 bg-blue-900/50 text-blue-400 rounded text-xs">
                  A Caminho
                </span>
                {% elif placa.received %}
                <span class="inline-flex items-center px-2 py-1 bg-indigo-900/50 text-indigo-400 rounded text-xs">
                  Recebida
                </span>
                {% else %}
                <span class="inline-flex items-center px-2 py-1 bg-yellow-900/50 text-yellow-400 rounded text-xs">
                  Pendente
                </span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      <!-- Mobile Cards -->
      <div class="md:hidden space-y-3">
        {% for placa in user.placas[:5] %}
        <div class="bg-gray-700/50 border border-gray-600 rounded-lg p-4 hover:bg-gray-700">
          <div class="flex justify-between items-start mb-3">
            <div>
              <p class="font-bold text-white text-lg">{{ placa.placa }}</p>
              <p class="text-gray-400 text-sm mt-1">
                <i class="fas fa-barcode mr-1"></i>
                Chassi: <span class="text-gray-300">{{ placa.chassi or 'N/A' }}</span>
              </p>
            </div>
            <div>
              {% if placa.placa_confeccionada %}
              <span class="inline-flex items-center px-2 py-1 bg-green-900/50 text-green-400 rounded text-xs">
                Confeccionada
              </span>
              {% elif placa.placa_a_caminho %}
              <span class="inline-flex items-center px-2 py-1 bg-blue-900/50 text-blue-400 rounded text-xs">
                A Caminho
              </span>
              {% elif placa.received %}
              <span class="inline-flex items-center px-2 py-1 bg-indigo-900/50 text-indigo-400 rounded text-xs">
                Recebida
              </span>
              {% else %}
              <span class="inline-flex items-center px-2 py-1 bg-yellow-900/50 text-yellow-400 rounded text-xs">
                Pendente
              </span>
              {% endif %}
            </div>
          </div>
          <div class="flex items-center text-gray-500 text-sm">
            <i class="fas fa-calendar-alt mr-2"></i>
            <span>
              {% if placa.date_create %}
                {% if placa.date_create is string %}
                  {{ placa.date_create }}
                {% else %}
                  {{ placa.date_create.strftime('%d/%m/%Y') }}
                {% endif %}
              {% else %}
                N/A
              {% endif %}
            </span>
          </div>
        </div>
        {% endfor %}
      </div>
      
      {% if user.placas|length > 5 %}
      <div class="mt-4 text-center">
        <span class="text-gray-500 text-sm">+ {{ user.placas|length - 5 }} outras</span>
      </div>
      {% endif %}
    </div>
    {% endif %}

    <!-- Latest Payments -->
    {% if user.pagamentos %}
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
      <h3 class="text-lg font-bold text-white mb-4 flex items-center">
        <i class="fas fa-credit-card text-blue-400 mr-2"></i>
        Últimos Pagamentos
      </h3>
      <div class="space-y-3">
        {% for pagamento in user.pagamentos[:3] %}
        <div class="flex justify-between items-center p-4 bg-gray-700/30 border border-gray-600 rounded-lg hover:bg-gray-700/50">
          <div>
            <p class="font-medium text-white">Pagamento #{{ pagamento.id_pagamento }}</p>
            {% if pagamento.data_pagamento %}
              <p class="text-gray-500 text-sm mt-1">
                <i class="fas fa-clock mr-1"></i>
                {% if pagamento.data_pagamento is string %}
                  {{ pagamento.data_pagamento }}
                {% else %}
                  {{ pagamento.data_pagamento.strftime('%d/%m/%Y %H:%M') }}
                {% endif %}
              </p>
            {% endif %}
          </div>
          <div class="text-right">
            <p class="text-lg font-bold text-white">
              R$ {{ "%.2f"|format(pagamento.valor_transacao) if pagamento.valor_transacao else '0,00' }}
            </p>
            <span class="{% if pagamento.status_pagamento == 'approved' %}text-green-400{% else %}text-yellow-400{% endif %} text-sm font-medium">
              {{ pagamento.status_pagamento|title if pagamento.status_pagamento else 'Pendente' }}
            </span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
/* Custom scrollbar for dark theme */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(31, 41, 55, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(59, 130, 246, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(59, 130, 246, 0.7);
}

/* Smooth transitions */
.bg-gray-700\/50, .bg-gray-800, .bg-gray-900 {
  transition: background-color 0.2s ease;
}
</style>
{% endblock %}