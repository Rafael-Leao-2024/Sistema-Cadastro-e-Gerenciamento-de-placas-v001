{% extends "layout.html" %}

{% block title %}Minhas Atividades{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 to-gray-950">
  <!-- Header -->
  <div class="bg-gray-800/50 border-b border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <div class="p-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl">
              <i class="fas fa-history text-white text-xl"></i>
            </div>
            <div>
              <h1 class="text-2xl font-bold text-white">Histórico de Atividades</h1>
              <p class="text-gray-400 text-sm mt-1">Registro completo das ações realizadas</p>
            </div>
          </div>
          <div class="hidden sm:block">
            <div class="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg">
              <span class="font-medium">{{ atividades|length }}</span>
              <span class="text-sm">atividade{{ 's' if atividades|length != 1 else '' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Stats Overview -->
    <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-gray-800/50 rounded-xl border border-gray-700 p-4">
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-blue-500/20 rounded-lg">
            <i class="fas fa-sign-in-alt text-blue-400"></i>
          </div>
          <div>
            <p class="text-gray-400 text-sm">Login</p>
            <p class="text-xl font-bold text-white">
              {{ atividades|selectattr('acao', 'equalto', 'LOGIN')|list|length }}
            </p>
          </div>
        </div>
      </div>

      <div class="bg-gray-800/50 rounded-xl border border-gray-700 p-4">
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-green-500/20 rounded-lg">
            <i class="fas fa-download text-green-400"></i>
          </div>
          <div>
            <p class="text-gray-400 text-sm">Recebimentos</p>
            <p class="text-xl font-bold text-white">
              {{ atividades|selectattr('acao', 'equalto', 'RECEBIMENTO')|list|length }}
            </p>
          </div>
        </div>
      </div>

      <div class="bg-gray-800/50 rounded-xl border border-gray-700 p-4">
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-amber-500/20 rounded-lg">
            <i class="fas fa-sync-alt text-amber-400"></i>
          </div>
          <div>
            <p class="text-gray-400 text-sm">Atualizações</p>
            <p class="text-xl font-bold text-white">
              {{ atividades|selectattr('acao', 'equalto', 'ATUALIZADO')|list|length }}
            </p>
          </div>
        </div>
      </div>

      <div class="bg-gray-800/50 rounded-xl border border-gray-700 p-4">
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-red-500/20 rounded-lg">
            <i class="fas fa-trash text-red-400"></i>
          </div>
          <div>
            <p class="text-gray-400 text-sm">Exclusões</p>
            <p class="text-xl font-bold text-white">
              {{ atividades|selectattr('acao', 'equalto', 'DELETE')|list|length }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filter Buttons -->
    <div class="flex flex-wrap gap-2 mb-6">
      <button class="filter-btn active px-4 py-2 bg-blue-600 text-white rounded-lg font-medium text-sm" data-filter="all">
        <i class="fas fa-layer-group mr-2"></i>Todas
      </button>
      <button class="filter-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg font-medium text-sm" data-filter="LOGIN">
        <i class="fas fa-sign-in-alt mr-2"></i>Login
      </button>
      <button class="filter-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg font-medium text-sm" data-filter="RECEBIMENTO">
        <i class="fas fa-download mr-2"></i>Recebimento
      </button>
      <button class="filter-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg font-medium text-sm" data-filter="ATUALIZADO">
        <i class="fas fa-sync-alt mr-2"></i>Atualizações
      </button>
      <button class="filter-btn px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg font-medium text-sm" data-filter="DELETE">
        <i class="fas fa-trash mr-2"></i>Exclusões
      </button>
    </div>

    <!-- Activities List -->
    {% if atividades %}
      <!-- Mobile View -->
      <div class="lg:hidden space-y-4">
        {% for atividade in atividades %}
        <div class="activity-card bg-gray-800/30 border border-gray-700 rounded-xl p-4" data-action="{{ atividade.acao }}">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center space-x-3">
              {% if atividade.acao == "LOGIN" %}
              <div class="p-2 bg-blue-500/20 rounded-lg">
                <i class="fas fa-sign-in-alt text-blue-400"></i>
              </div>
              {% elif atividade.acao == "RECEBIMENTO" %}
              <div class="p-2 bg-green-500/20 rounded-lg">
                <i class="fas fa-download text-green-400"></i>
              </div>
              {% elif atividade.acao == "ATUALIZADO" %}
              <div class="p-2 bg-amber-500/20 rounded-lg">
                <i class="fas fa-sync-alt text-amber-400"></i>
              </div>
              {% elif atividade.acao == "DELETE" %}
              <div class="p-2 bg-red-500/20 rounded-lg">
                <i class="fas fa-trash text-red-400"></i>
              </div>
              {% else %}
              <div class="p-2 bg-gray-600 rounded-lg">
                <i class="fas fa-info-circle text-gray-400"></i>
              </div>
              {% endif %}
              
              <div>
                <h3 class="font-bold text-white">
                  {% if atividade.acao == "LOGIN" %}
                  Login no sistema
                  {% elif atividade.acao == "RECEBIMENTO" %}
                  Recebimento de placa
                  {% elif atividade.acao == "ATUALIZADO" %}
                  Atualização de dados
                  {% elif atividade.acao == "DELETE" %}
                  Exclusão de item
                  {% else %}
                  {{ atividade.acao }}
                  {% endif %}
                </h3>
                <div class="flex items-center space-x-2 mt-1">
                  <i class="fas fa-clock text-gray-500 text-xs"></i>
                  <span class="text-gray-400 text-sm">
                    {{ atividade.data.strftime("%d/%m/%Y %H:%M") }}
                  </span>
                </div>
              </div>
            </div>
            
            {% if atividade.acao == "LOGIN" %}
            <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs font-medium">
              <i class="fas fa-check mr-1"></i>Sucesso
            </span>
            {% elif atividade.acao == "RECEBIMENTO" %}
            <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs font-medium">
              <i class="fas fa-check mr-1"></i>Concluído
            </span>
            {% elif atividade.acao == "ATUALIZADO" %}
            <span class="px-2 py-1 bg-amber-500/20 text-amber-400 rounded text-xs font-medium">
              <i class="fas fa-sync-alt mr-1"></i>Atualizado
            </span>
            {% elif atividade.acao == "DELETE" %}
            <span class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs font-medium">
              <i class="fas fa-exclamation-triangle mr-1"></i>Excluído
            </span>
            {% endif %}
          </div>

          <div class="mb-4">
            <p class="text-gray-300 text-sm line-clamp-2">
              {{ atividade.descricao or "Ação realizada no sistema" }}
            </p>
          </div>

          <a href="{{ url_for('atividade.detalhe_atividade', id_atividade=atividade.id) }}"
             class="block w-full text-center bg-gray-700 hover:bg-gray-600 text-gray-300 py-2 rounded-lg transition-colors duration-200 text-sm font-medium">
            <i class="fas fa-external-link-alt mr-2"></i>
            Ver detalhes
          </a>
        </div>
        {% endfor %}
      </div>

      <!-- Desktop View -->
      <div class="hidden lg:block bg-gray-800/30 rounded-xl border border-gray-700 overflow-hidden">
        <div class="grid grid-cols-12 gap-4 p-6 border-b border-gray-700 bg-gray-800/50">
          <div class="col-span-3">
            <span class="text-gray-400 font-medium text-sm">Ação</span>
          </div>
          <div class="col-span-5">
            <span class="text-gray-400 font-medium text-sm">Descrição</span>
          </div>
          <div class="col-span-2">
            <span class="text-gray-400 font-medium text-sm">Data</span>
          </div>
          <div class="col-span-2">
            <span class="text-gray-400 font-medium text-sm">Status</span>
          </div>
        </div>

        <div class="divide-y divide-gray-700">
          {% for atividade in atividades %}
          <div class="activity-card grid grid-cols-12 gap-4 p-6 hover:bg-gray-700/20 transition-colors" data-action="{{ atividade.acao }}">
            <div class="col-span-3">
              <div class="flex items-center space-x-3">
                {% if atividade.acao == "LOGIN" %}
                <div class="p-3 bg-blue-500/20 rounded-lg">
                  <i class="fas fa-sign-in-alt text-blue-400"></i>
                </div>
                <div>
                  <p class="font-medium text-white">Login</p>
                  <p class="text-blue-400 text-sm">Acesso ao sistema</p>
                </div>
                {% elif atividade.acao == "RECEBIMENTO" %}
                <div class="p-3 bg-green-500/20 rounded-lg">
                  <i class="fas fa-download text-green-400"></i>
                </div>
                <div>
                  <p class="font-medium text-white">Recebimento</p>
                  <p class="text-green-400 text-sm">Processo recebido</p>
                </div>
                {% elif atividade.acao == "ATUALIZADO" %}
                <div class="p-3 bg-amber-500/20 rounded-lg">
                  <i class="fas fa-sync-alt text-amber-400"></i>
                </div>
                <div>
                  <p class="font-medium text-white">Atualização</p>
                  <p class="text-amber-400 text-sm">Dados modificados</p>
                </div>
                {% elif atividade.acao == "DELETE" %}
                <div class="p-3 bg-red-500/20 rounded-lg">
                  <i class="fas fa-trash text-red-400"></i>
                </div>
                <div>
                  <p class="font-medium text-white">Exclusão</p>
                  <p class="text-red-400 text-sm">Item removido</p>
                </div>
                {% else %}
                <div class="p-3 bg-gray-600 rounded-lg">
                  <i class="fas fa-info-circle text-gray-400"></i>
                </div>
                <div>
                  <p class="font-medium text-white">{{ atividade.acao }}</p>
                  <p class="text-gray-400 text-sm">Outra ação</p>
                </div>
                {% endif %}
              </div>
            </div>

            <div class="col-span-5">
              <a href="{{ url_for('atividade.detalhe_atividade', id_atividade=atividade.id) }}"
                 class="block text-gray-300 hover:text-white transition-colors">
                <p class="line-clamp-2">{{ atividade.descricao or "Ação realizada no sistema" }}</p>
              </a>
            </div>

            <div class="col-span-2">
              <div>
                <p class="text-gray-300">{{ atividade.data.strftime("%d/%m/%Y") }}</p>
                <p class="text-gray-500 text-sm">{{ atividade.data.strftime("%H:%M") }}</p>
              </div>
            </div>

            <div class="col-span-2">
              {% if atividade.acao == "LOGIN" %}
              <span class="inline-flex items-center px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm font-medium">
                <i class="fas fa-check-circle mr-2"></i>
                Sucesso
              </span>
              {% elif atividade.acao == "RECEBIMENTO" %}
              <span class="inline-flex items-center px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-medium">
                <i class="fas fa-check-circle mr-2"></i>
                Concluído
              </span>
              {% elif atividade.acao == "ATUALIZADO" %}
              <span class="inline-flex items-center px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm font-medium">
                <i class="fas fa-sync-alt mr-2"></i>
                Atualizado
              </span>
              {% elif atividade.acao == "DELETE" %}
              <span class="inline-flex items-center px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-medium">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                Excluído
              </span>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

    {% else %}
      <!-- Empty State -->
      <div class="bg-gray-800/30 border border-gray-700 rounded-xl p-12 text-center">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gray-700 mb-6">
          <i class="fas fa-inbox text-3xl text-gray-400"></i>
        </div>
        <h3 class="text-xl font-bold text-white mb-3">Nenhuma atividade registrada</h3>
        <p class="text-gray-400 max-w-md mx-auto mb-6">
          Suas ações aparecerão aqui assim que você começar a usar o sistema.
        </p>
        <a href="{{ url_for('placas.homepage') }}"
           class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200 font-medium">
          <i class="fas fa-home mr-2"></i>
          Voltar para o início
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- Activity Summary Modal -->
<div id="activitySummary" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
  <div class="bg-gray-800 border border-gray-700 rounded-xl max-w-md w-full p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-bold text-white">Resumo de Atividades</h3>
      <button onclick="closeSummary()" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="space-y-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-3 h-3 rounded-full bg-blue-500"></div>
          <span class="text-gray-300">Login</span>
        </div>
        <span class="text-white font-medium">
          {{ atividades|selectattr('acao', 'equalto', 'LOGIN')|list|length }}
        </span>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-3 h-3 rounded-full bg-green-500"></div>
          <span class="text-gray-300">Recebimentos</span>
        </div>
        <span class="text-white font-medium">
          {{ atividades|selectattr('acao', 'equalto', 'RECEBIMENTO')|list|length }}
        </span>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-3 h-3 rounded-full bg-amber-500"></div>
          <span class="text-gray-300">Atualizações</span>
        </div>
        <span class="text-white font-medium">
          {{ atividades|selectattr('acao', 'equalto', 'ATUALIZADO')|list|length }}
        </span>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-3 h-3 rounded-full bg-red-500"></div>
          <span class="text-gray-300">Exclusões</span>
        </div>
        <span class="text-white font-medium">
          {{ atividades|selectattr('acao', 'equalto', 'DELETE')|list|length }}
        </span>
      </div>
    </div>
    
    <div class="mt-6 pt-6 border-t border-gray-700">
      <div class="flex items-center justify-between">
        <span class="text-gray-400">Total</span>
        <span class="text-xl font-bold text-white">{{ atividades|length }}</span>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterButtons = document.querySelectorAll('.filter-btn');
  const activityCards = document.querySelectorAll('.activity-card');
  
  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      const filter = this.getAttribute('data-filter');
      
      // Update active button
      filterButtons.forEach(btn => {
        btn.classList.remove('active', 'bg-blue-600', 'text-white');
        btn.classList.add('bg-gray-700', 'text-gray-300');
      });
      this.classList.add('active', 'bg-blue-600', 'text-white');
      this.classList.remove('bg-gray-700', 'text-gray-300');
      
      // Filter activities
      activityCards.forEach(card => {
        if (filter === 'all' || card.getAttribute('data-action') === filter) {
          card.style.display = 'flex';
          if (card.parentElement.classList.contains('space-y-4')) {
            card.style.display = 'block';
          }
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
});

function showSummary() {
  const modal = document.getElementById('activitySummary');
  modal.classList.remove('hidden');
  modal.classList.add('flex');
}

function closeSummary() {
  const modal = document.getElementById('activitySummary');
  modal.classList.remove('flex');
  modal.classList.add('hidden');
}

// Close modal when clicking outside
document.getElementById('activitySummary').addEventListener('click', function(e) {
  if (e.target === this) closeSummary();
});
</script>

<style>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.activity-card {
  transition: all 0.2s ease;
}

.activity-card:hover {
  transform: translateY(-2px);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(31, 41, 55, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(59, 130, 246, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(59, 130, 246, 0.7);
}
</style>
{% endblock %}